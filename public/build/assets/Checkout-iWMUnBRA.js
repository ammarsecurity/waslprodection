import{_ as J,a as K,x as H,u as E,q as R,G as ee,r as _,o as Q,c as h,d as m,f as e,e as O,h as x,t as o,l,F as L,j as B,g as q,A as V,B as Z,s as W,m as te,p as se,a8 as oe,a9 as ae,y as F,a0 as ne,aa as X,ab as re,w as N,b as le,i as Y,ac as ie,$ as G,T as ce}from"./app-cYBtX5T3.js";import{_ as de}from"./OrderConfirmModal-v2UAC0L_.js";import{_ as ue}from"./VerifyOtpModal-BYq8bXvD.js";import{r as me}from"./TrashIcon-CtsI5F1W.js";import{C as pe}from"./CheckoutShippingAddress-BMbqi6pt.js";import{r as he}from"./HomeIcon-B5if67XY.js";const ve={class:"p-6 bg-white rounded-2xl border border-slate-200"},fe={class:"text-slate-950 text-xl font-medium leading-7"},_e={class:"my-4 flex justify-between gap-4"},ye={class:"text-slate-950 text-base font-normal leading-normal"},ge={class:"text-slate-950 text-base font-normal leading-normal"},be={class:"my-4 flex justify-between gap-4"},xe={class:"text-red-500 text-base font-normal leading-normal"},we={class:"text-slate-950 text-base font-normal leading-normal"},$e={class:"my-4 flex justify-between gap-4"},ke={class:"text-slate-950 text-base font-normal leading-normal"},Ce={class:"text-slate-950 text-base font-normal leading-normal"},Pe={class:"my-4 flex justify-between gap-4"},Me={class:"text-slate-950 text-base font-normal leading-normal"},Ae={class:"text-slate-950 text-base font-normal leading-normal"},Se={key:0,class:"p-3 bg-slate-100 text-black rounded-lg mb-2"},De={class:"text-sm sm:text-base font-medium mb-2"},je={class:"space-y-2"},Ie={class:"font-medium"},Oe={class:"font-medium"},Ne={class:"mt-4 p-3 bg-slate-200 rounded-lg"},Te={class:"text-sm sm:text-base font-medium"},Ve={class:"text-base font-bold"},Le={class:"my-4 flex justify-between gap-4"},Be={class:"text-slate-950 text-lg font-medium leading-normal tracking-tight"},Ue={class:"text-slate-950 text-lg font-medium leading-normal tracking-tight"},ze={class:"p-4 mt-6 bg-slate-100 rounded-xl"},Ge={class:"text-black text-base font-normal leading-normal"},We={class:"relative mt-2"},Fe=["placeholder"],He={class:"absolute top-1/2 -translate-y-1/2 left-3"},Ee={key:0,class:"p-4 bg-white rounded-xl border border-slate-200 flex items-center justify-between mt-3"},Re={class:"animated-text"},qe={key:2,type:"button",class:"px-6 py-4 w-full mt-4 bg-primary-200 rounded-[10px] text-primary text-base font-semibold flex items-center justify-center gap-2",disabled:""},Xe={__name:"CheckoutOrderSummary",props:{note:String,paymentMethod:String,deliveryCharge:{type:Number,default:0},selectedProvinces:{type:Object,default:()=>({})},provinceName:{type:String,default:""},provinceArea:{type:String,default:""},nearestLandmark:{type:String,default:""},showCurrency:{type:Function,default:null}},setup(U){const $=new K,s=H(),n=E(),k=R(),u=ee(),p=_(!1),y=_(""),v=_(!1),c=U,j=()=>{const r=s.total_amount-s.coupon_discount,i=c.deliveryCharge||s.delivery_charge,f=s.order_tax_amount||0,b=r+i+f;return c.showCurrency?c.showCurrency(b):n.showCurrency(b)};Q(()=>{y.value=s.coupon_code});const C=()=>{y.value.length>0&&D()},S=()=>{y.value="",p.value=!1,s.coupon_code="",D()},P={component:ne,props:{title:"Order Placed",message:"Your order has been placed successfully."}},M=_(!1),T=()=>{if(!c.selectedProvinces||Object.keys(c.selectedProvinces).length===0){const i=n.locale==="ar"?"يرجى اختيار المحافظة":"Please select a province";u.error(i,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"});return}const r=s.selectedShopIds||[];for(const i of r)if(!c.selectedProvinces[i]){const f=n.locale==="ar"?"يرجى اختيار المحافظة لجميع المتاجر":"Please select province for all shops";u.error(f,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"});return}if(!c.provinceArea||c.provinceArea.trim()===""){const i=n.locale==="ar"?"يرجى إدخال المنطقة":"Please enter area";u.error(i,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"});return}if(c.paymentMethod==null||c.paymentMethod=="card"){const i=n.locale==="ar"?"يرجى اختيار طريقة الدفع":"Please select payment method";u.error(i,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"});return}if(s.checkoutProducts.length>0){M.value=!0;const i={province_name:c.provinceName||"",province_area:c.provinceArea||"",nearest_landmark:c.nearestLandmark||"",provinces:c.selectedProvinces||{}};F.post("/place-order",{shop_ids:s.selectedShopIds,payment_method:c.paymentMethod,coupon_code:y.value,note:c.note,delivery_charge:c.deliveryCharge,...i},{headers:{Authorization:k.token}}).then(f=>{s.checkoutProducts=[],s.selectedShopIds=[],s.coupon_code="",s.total_amount=0,s.delivery_charge=0,s.coupon_discount=0,s.payable_amount=0,M.value=!1,s.fetchCart(),u(P,{type:"default",hideProgressBar:!0,icon:!1,position:n.langDirection==="rtl"?"bottom-right":"bottom-left",toastClassName:"vue-toastification-alert",timeout:2e3});let b=f.data.data.order_payment_url;if(b!=null){I(b);return}else s.showOrderConfirmModal=!0}).catch(f=>{u.error(f.response.data.message,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"}),M.value=!1})}else u.error("Please select at least one product",{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"})},I=r=>{let i=700,f=700,b=screen.width/2-i/2,g=screen.height/2-f/2,a="popup,resizable,height="+f+",width="+i+",top="+g+",left="+b,t=window.open(r,null,a);if(t.title="Payment Window Screen - Make Payment",t.onload=()=>{t.title="Payment Window Screen - Make Payment",t.closed&&console.log("close window")},t.focus(),t.closed){u.error("Payment Canceled",{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"}),$.push({name:"home"});return}var w=setInterval(d,1e3);function d(){try{if(t.closed||!t){clearInterval(w),t.close(),s.orderPaymentCancelModal=!0,u.error("Payment Canceled",{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"}),$.push({name:"home"});return}var A=t.location.pathname.replace(/\/order\/\d+/,"");if(A=="/payment/cancel"){clearInterval(w),setTimeout(()=>{t.close(),s.orderPaymentCancelModal=!0,u.error("Payment Canceled",{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"}),$.push({name:"home"})},8e3);return}if(A=="/payment/success"){t.close(),clearInterval(w),s.showOrderConfirmModal=!0;return}}catch{}}setTimeout(()=>{clearInterval(w),t.close()},18e4)},D=()=>{F.post("/cart/checkout",{shop_ids:s.selectedShopIds,coupon_code:y.value},{headers:{Authorization:k.token}}).then(r=>{p.value=r.data.data.apply_coupon,s.total_amount=r.data.data.checkout.total_amount,s.delivery_charge=r.data.data.checkout.delivery_charge,s.coupon_discount=r.data.data.checkout.coupon_discount,s.payable_amount=r.data.data.checkout.payable_amount,p.value?(u.success(r.data.message,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"}),s.coupon_code=y.value):(u.error(r.data.message,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"}),s.coupon_code="")}).catch(r=>{u.error(r.response.data.message,{position:n.langDirection==="rtl"?"bottom-right":"bottom-left"})})};return(r,i)=>{var f,b;return m(),h("div",null,[e("div",ve,[e("div",fe,o(r.$t("Order Summary")),1),e("div",_e,[e("div",ye,o(r.$t("Subtotal")),1),e("div",ge,o(l(n).showCurrency(l(s).total_amount)),1)]),e("div",be,[e("div",xe,o(r.$t("Discount")),1),e("div",we," -"+o(l(n).showCurrency(l(s).coupon_discount)),1)]),i[3]||(i[3]=e("div",{class:"w-full h-[0px] border-t border-dashed border-slate-400"},null,-1)),e("div",$e,[e("div",ke,o(r.$t("Subtotal After Discount")),1),e("div",Ce,o(l(n).showCurrency((l(s).total_amount-l(s).coupon_discount).toFixed(2))),1)]),e("div",Pe,[e("div",Me,o(r.$t("Shipping Charge")),1),e("div",Ae,o(c.showCurrency?c.showCurrency(c.deliveryCharge||l(s).delivery_charge):l(n).showCurrency(c.deliveryCharge||l(s).delivery_charge)),1)]),((f=l(s).all_vat_taxes)==null?void 0:f.length)>0||l(s).order_tax_amount>0?(m(),h("div",Se,[e("h2",De,o(r.$t("VAT & Taxes Summary")),1),e("div",je,[(m(!0),h(L,null,B(l(s).all_vat_taxes,g=>(m(),h("div",{key:g.id,class:"flex justify-between bg-slate-200 p-2 rounded-lg"},[e("span",Ie,[q(o(g.name)+" ",1),e("small",null,"("+o(g.percentage)+"%)",1)]),e("span",Oe,o(l(n).showCurrency(g.amount)),1)]))),128))]),e("div",Ne,[e("h3",Te,o(r.$t("Total Tax Amount"))+": ",1),e("p",Ve,o(l(n).showCurrency(l(s).order_tax_amount)),1)])])):O("",!0),i[4]||(i[4]=e("div",{class:"w-full h-[0px] border border-slate-500"},null,-1)),e("div",Le,[e("div",Be,o(r.$t("Total Payable")),1),e("div",Ue,o(j()),1)]),e("div",ze,[e("div",Ge,o(r.$t("Have a coupon"))+"? ",1),e("div",We,[V(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=g=>y.value=g),class:W(["formInputCoupon pr-14 p-3",p.value?"text-green-500 pl-10":""]),placeholder:r.$t("Enter coupon code")},null,10,Fe),[[Z,y.value]]),p.value?(m(),h("button",{key:1,class:"bg-slate-100 absolute top-1/2 -translate-y-1/2 right-1.5 h-10 w-10 rounded flex justify-center items-center",onClick:S},[x(l(me),{class:"w-6 h-6 text-red-500"})])):(m(),h("button",{key:0,class:"bg-slate-700 absolute top-1/2 -translate-y-1/2 right-1.5 h-10 w-10 rounded flex justify-center items-center",onClick:C},[x(l(te),{class:"w-6 h-6 text-white"})])),e("span",He,[p.value?(m(),se(l(oe),{key:0,class:"w-6 h-6 text-green-500"})):O("",!0)])])])]),!((b=l(k).user)!=null&&b.account_verified)&&l(n).orderPlaceAccountVerify?(m(),h("div",Ee,[e("span",Re,o(r.$t("Please verify your account")),1),e("button",{class:"p-2 border border-primary rounded-md bg-primary-50 text-primary text-sm font-medium",onClick:i[1]||(i[1]=g=>v.value=!0)},o(r.$t("Verify Now")),1)])):O("",!0),M.value?(m(),h("button",qe,[q(o(r.$t("Processing"))+" ",1),x(ae)])):(m(),h("button",{key:1,class:"px-6 py-4 w-full mt-4 bg-primary rounded-[10px] text-white text-base font-medium",onClick:T},o(r.$t("Place Order")),1)),x(de),x(ue,{showModal:v.value,onHideModal:i[2]||(i[2]=g=>v.value=!1)},null,8,["showModal"])])}}},Ye=J(Xe,[["__scopeId","data-v-391a9133"]]),Je={class:"space-y-4 mt-3 transition duration-300"},Ke={class:"text-slate-950 text-base font-medium leading-normal"},Qe={class:"space-y-2 divide-y divide-slate-200"},Ze={class:"w-[72px] h-[95px]"},et=["src"],tt={class:"flex flex-col gap-1 w-full"},st={class:"text-primary text-xs font-normal leading-none"},ot={class:"text-slate-950 text-base font-normal leading-normal"},at={class:"flex flex-wrap justify-between items-center gap-3"},nt={class:"flex items-center gap-1"},rt={class:"min-w-8 text-center px-2 py-1 bg-slate-100 rounded text-slate-800 text-xs font-normal"},lt={class:"px-2 py-1 bg-slate-100 rounded text-slate-800 text-xs font-normal"},it={class:"text-slate-800 text-base font-normal leading-normal"},ct={__name:"checkoutProducts",setup(U){R();const $=E(),s=H();return(n,k)=>(m(),h("div",Je,[(m(!0),h(L,null,B(l(s).checkoutProducts,u=>(m(),h("div",{key:u.shop_id,class:"px-4 py-3 bg-slate-50 rounded-xl border border-slate-100"},[e("div",Ke,o(u.shop_name),1),e("div",Qe,[(m(!0),h(L,null,B(u.products,p=>{var y,v;return m(),h("div",{key:p.id,class:"flex gap-4 justify-start w-full items-center pt-1"},[e("div",Ze,[e("img",{src:p.thumbnail,class:"w-full h-full object-contain"},null,8,et)]),e("div",tt,[e("div",st,o(p.brand),1),e("div",ot,o(p.name),1),e("div",at,[e("div",nt,[e("div",rt,o((y=p.size)==null?void 0:y.name),1),e("div",lt,o((v=p.color)==null?void 0:v.name),1)]),e("div",it,o(p.quantity)+" X "+o(l($).showCurrency(p.discount_price>0?p.discount_price:p.price)),1)])])])}),128))])]))),128))]))}},dt={class:"main-container"},ut={class:"flex items-center gap-2 overflow-hidden pt-4"},mt={class:"grow w-full overflow-hidden"},pt={class:"space-x-1 text-slate-600 text-sm font-normal truncate"},ht={class:"grid grid-cols-1 xl:grid-cols-3 my-3 gap-8"},vt={class:"col-span-1 xl:col-span-2"},ft={class:"flex gap-2 justify-between items-center"},_t={class:"text-slate-950 text-lg sm:text-3xl font-medium leading-10"},yt={class:"text-primary-600 text-lg font-medium leading-normal tracking-tight"},gt={key:0},bt={class:"mt-6"},xt={class:"mb-1"},wt={class:"text-slate-950 text-xl font-medium leading-7"},$t={class:"text-slate-500 text-lg font-normal leading-7 tracking-tight"},kt=["placeholder"],Ct={class:"p-6 mt-4 bg-white rounded-2xl border border-slate-200"},Pt={class:"text-slate-950 text-xl font-medium leading-7"},Mt={class:"mt-4 flex flex-wrap gap-4"},At={key:0,for:"cash",class:"flex items-center gap-4 xl:min-w-80"},St={class:"text-slate-500 text-base font-normal leading-normal"},Dt={key:1,for:"card",class:"flex items-center gap-4 xl:min-w-80"},jt={class:"text-slate-500 text-base font-normal leading-normal"},It={key:0,class:"mt-5 border-t border-slate-200"},Ot={class:"text-slate-600 pt-2 block text-md font-medium leading-7"},Nt={class:"mt-3 flex flex-wrap gap-4"},Tt=["for"],Vt=["id","value"],Lt={class:""},Bt=["src"],Ut={__name:"Checkout",setup(U){const $=R(),s=new K,n=E(),k=H(),u=_(!1),p=_(""),y=n.cashOnDelivery?"cash":"card",v=_(y),c=_(null),j=_(null),C=X({shop_ids:[],address:{area:"",nearest_landmark:""}}),S=_({}),P=_({}),M=_(0),T=_(""),I=_(""),D=_(""),r=X({province:"",area:""});re(()=>Object.values(r).some(a=>a!==""));async function i(a){try{const{data:t}=await F.get(`/shop/${a}/provinces-delivery-charges`);return t.data||[]}catch(t){return console.error("Error fetching provinces:",t),[]}}const f=async()=>{let a=0;for(const t of C.shop_ids){const w=S.value[t]||[],d=P.value[t],A=w.find(z=>z.id==d);a+=A?Number(A.delivery_charge):0}M.value=a},b=(a,t)=>{a&&(r.province="");const d=(S.value[t]||[]).find(A=>A.id==a);d&&(C.address.area=d.province_name,T.value=d.province_name,I.value=d.province_name,D.value=C.address.nearest_landmark),f()};function g(a){try{return n.showCurrency?n.showCurrency(a):a}catch{return a}}return Q(async()=>{if(window.scrollTo(0,0),k.coupon_code="",c.value=v.value,!$.user){s.push({name:"guest-checkout"});return}if($.showAddressModal=!1,$.showChangeAddressModal=!1,k.products.length>0){const a=[...new Set(k.products.map(t=>t.shop_id))];C.shop_ids=a;for(const t of a){const w=await i(t);S.value[t]=w}await f()}}),N(()=>C.shop_ids,async a=>{if(a.length>0){for(const t of a)S.value[t]=await i(t);for(const t of a)P.value[t]||(P.value[t]="");M.value=0}else S.value={},P.value={},M.value=0},{deep:!0}),N(P,f,{deep:!0}),N(()=>C.address.nearest_landmark,a=>{D.value=a}),N(()=>C.address.area,a=>{I.value=a,T.value=a}),N(v,()=>{v.value==="card"?c.value=j.value:c.value=v.value}),N(j,()=>{v.value==="card"&&(c.value=j.value)}),(a,t)=>{const w=le("router-link");return m(),h("div",dt,[e("div",ut,[x(w,{to:"/",class:"w-6 h-6"},{default:Y(()=>[x(l(he),{class:"w-5 h-5 text-slate-600"})]),_:1}),e("div",mt,[e("div",pt,[e("span",null,o(a.$t("Home")),1),t[7]||(t[7]=e("span",null,"/",-1)),e("span",null,o(a.$t("Cart")),1),t[8]||(t[8]=e("span",null,"/",-1)),e("span",null,o(a.$t("Checkout")),1)])])]),e("div",ht,[e("div",vt,[e("div",{class:W(["py-4 border-b tran",u.value?"border-primary":"border-slate-200"])},[e("div",ft,[e("div",_t,o(a.$t("Checkout")),1),e("div",{class:"flex items-center gap-2 cursor-pointer",onClick:t[0]||(t[0]=d=>u.value=!u.value)},[e("div",yt," ("+o(l(k).checkoutTotalItems)+" "+o(a.$t("items"))+") ",1),x(l(ie),{class:W(["w-5 h-5 text-primary-600 transition duration-300",u.value?"rotate-180":""])},null,8,["class"])])]),u.value?(m(),h("div",gt,[x(ct)])):O("",!0)],2),x(pe,{shopProvinces:S.value,selectedProvinces:P.value,onChangeProvinces:b,showCurrency:g,provinceArea:I.value,nearestLandmark:D.value,"onUpdate:nearestLandmark":t[1]||(t[1]=d=>D.value=d),"onUpdate:provinceArea":t[2]||(t[2]=d=>I.value=d)},null,8,["shopProvinces","selectedProvinces","provinceArea","nearestLandmark"]),e("div",bt,[e("div",xt,[e("span",wt,o(a.$t("Note")),1),e("span",$t," ("+o(a.$t("Optional"))+") ",1)]),V(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=d=>p.value=d),rows:"3",class:"form-input",placeholder:a.$t("Write your note")+"..."},null,8,kt),[[Z,p.value]])]),e("div",Ct,[e("div",Pt,o(a.$t("Payment Method")),1),e("div",Mt,[l(n).cashOnDelivery?(m(),h("label",At,[V(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>v.value=d),id:"cash",name:"payment",type:"radio",class:"radioBtn2",value:"cash",checked:""},null,512),[[G,v.value]]),t[9]||(t[9]=e("div",{class:"p-2 bg-white rounded-xl border border-slate-200"},[e("img",{src:"assets/icons/money-2.svg",alt:"",class:"w-7 h-7"})],-1)),e("span",St,o(a.$t("Cash on delivery")),1)])):O("",!0),l(n).onlinePayment?(m(),h("label",Dt,[V(e("input",{"onUpdate:modelValue":t[5]||(t[5]=d=>v.value=d),id:"card",name:"payment",type:"radio",class:"radioBtn2",value:"card"},null,512),[[G,v.value]]),t[10]||(t[10]=e("div",{class:"p-2 bg-white rounded-xl border border-slate-200"},[e("img",{src:"assets/icons/card.svg",alt:"",class:"w-7 h-7"})],-1)),e("span",jt,o(a.$t("Credit or Debit Card")),1)])):O("",!0)]),x(ce,{"leave-active-class":"transition ease-in duration-300","enter-active-class":"transition ease-out duration-300","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:Y(()=>[v.value==="card"?(m(),h("div",It,[e("span",Ot,o(a.$t("Available Payment Gateways")),1),e("div",Nt,[(m(!0),h(L,null,B(l(n).paymentGateways,d=>(m(),h("label",{key:d.id,for:d.name,class:"flex items-center gap-4 border relative has-[:checked]:border-primary has-[:checked]:shadow-lg p-2 rounded-md border-slate-200 cursor-pointer"},[V(e("input",{"onUpdate:modelValue":t[6]||(t[6]=A=>j.value=A),id:d.name,name:"paymentGateway",type:"radio",class:"sr-only",value:d.name},null,8,Vt),[[G,j.value]]),e("div",Lt,[e("img",{src:d.logo,alt:"",class:"w-32 h-16 object-contain"},null,8,Bt)])],8,Tt))),128))])])):O("",!0)]),_:1})])]),x(Ye,{note:p.value,paymentMethod:c.value,deliveryCharge:M.value,selectedProvinces:P.value,provinceName:T.value,provinceArea:I.value,nearestLandmark:D.value,showCurrency:g},null,8,["note","paymentMethod","deliveryCharge","selectedProvinces","provinceName","provinceArea","nearestLandmark"])])])}}},Rt=J(Ut,[["__scopeId","data-v-1005ec64"]]);export{Rt as default};
