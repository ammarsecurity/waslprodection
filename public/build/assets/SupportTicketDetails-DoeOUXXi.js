import{u as V,a as P}from"./framework-C9q9PHhQ.js";import{_ as R}from"./AuthPageHeader-B7hSdchQ.js";import{l as E,c as O,Z as W}from"./media-mZLhuSFq.js";import{_ as z,u as H,a as I,f as U,s as Z}from"./app-i4sZYluG.js";import{bC as N,u as n,aK as l,v as t,b9 as r,at as $,F as M,aV as C,aS as v,aC as F,as as B,t as S,bi as k,bJ as q,by as G,s as L,bM as J,aH as K,aX as X,I as y,bH as Q,H as Y}from"./vendor-Cy4BBKy_.js";import{u as tt,ae as et,c as st}from"./ui-BDBDEXQQ.js";import"./utilities-STV8t6c4.js";import"./icons-DjuF0c5-.js";const at={class:"p-4 bg-white rounded-xl border border-slate-200 ticket-details"},ot={class:"flex justify-between items-center gap-1.5 flex-wrap pb-3 border-b border-slate-200"},rt={class:"text-slate-500 text-sm font-normal"},it={class:"flex gap-2 items-center"},lt={class:"text-blue-500 text-sm"},nt={class:"flex justify-between items-center gap-2 flex-wrap pt-3"},ct={class:"flex flex-col gap-1"},ut={class:"text-slate-500 text-sm font-normal"},dt={class:"text-slate-900 text-sm"},pt={class:"flex flex-col gap-1 overflow-auto"},mt={class:"text-slate-500 text-sm font-normal"},ht={class:"text-slate-900 text-sm truncate max-w-60 lg:min-w-60"},_t={class:"flex flex-col gap-1 overflow-hidden mt-3"},gt={class:"text-slate-500 text-sm font-normal"},ft={class:"text-slate-900 text-sm truncate w-full"},kt={class:"text-black text-lg font-medium tracking-tight mt-4"},vt={class:"flex justify-between items-center gap-2 flex-wrap mt-3"},xt={class:"flex flex-col gap-1"},bt={class:"text-slate-500 text-sm font-normal"},Tt={class:"text-slate-900 text-sm"},yt={class:"flex flex-col gap-1"},$t={class:"text-slate-500 text-sm font-normal"},wt={class:"text-slate-900 text-sm"},St={class:"text-black text-lg font-medium tracking-tight mt-4"},Mt={class:"mt-3 flex flex-wrap gap-2.5",id:"gallery"},Ct=["href"],Nt=["src"],Dt=["href"],jt={class:"highlighted mt-6 flex flex-col gap-3"},At=["innerHTML"],Bt={__name:"SupportTicketDetails",props:{supportTicket:Object,highlightedMessages:Array},setup(i){const d=i,x=e=>e.type!="pdf",f=e=>e.type=="pdf";N(d,()=>{setTimeout(()=>{var e,a;((a=(e=d.supportTicket)==null?void 0:e.attachments)==null?void 0:a.length)>0&&E(document.getElementById("gallery"),{plugins:[O,W],speed:500})},500)});function c(e){var a=/(https?:\/\/[^\s]+)/g,g=e.replace(a,function(o){return'<a href="'+o+'" target="_blank">'+o+"</a>"});return g}return(e,a)=>{var g,o,u,p;return l(),n("div",at,[t("div",ot,[t("span",rt,r(i.supportTicket.created_at),1),t("div",it,[t("span",lt,"#"+r(i.supportTicket.ticket_no),1),t("span",{class:$(["px-2 py-1 rounded-xl capitalize text-xs ticketStatus",i.supportTicket.status])},r(i.supportTicket.status),3)])]),t("div",nt,[t("div",ct,[t("div",ut,r(e.$t("Order Number")),1),t("div",dt,r(i.supportTicket.order_number||"N/A"),1)]),t("div",pt,[t("div",mt,r(e.$t("Issue Type")),1),t("div",ht,r(i.supportTicket.issue_type),1)])]),t("div",_t,[t("div",gt,r(e.$t("Subject")),1),t("div",ft,r(i.supportTicket.subject),1)]),t("div",kt,r(e.$t("Contact Info")),1),t("div",vt,[t("div",xt,[t("div",bt,r(e.$t("Email")),1),t("div",Tt,r(i.supportTicket.email||"N/A"),1)]),t("div",yt,[t("div",$t,r(e.$t("Phone")),1),t("div",wt,r(i.supportTicket.phone||"N/A"),1)])]),t("div",St,r(e.$t("File Attachment")),1),t("div",Mt,[(l(!0),n(M,null,C((o=(g=i.supportTicket)==null?void 0:g.attachments)==null?void 0:o.filter(x),(s,m)=>(l(),n("a",{href:s.src,key:m,class:"w-12 h-12 border border-slate-200 rounded-lg"},[t("img",{src:s.src,class:"w-full h-full object-cover rounded-lg",loading:"lazy"},null,8,Nt)],8,Ct))),128)),(l(!0),n(M,null,C((p=(u=i.supportTicket)==null?void 0:u.attachments)==null?void 0:p.filter(f),(s,m)=>(l(),n("a",{href:s.src,key:m,class:"w-12 h-12 border border-slate-200 rounded-lg","data-iframe":"true"},a[0]||(a[0]=[t("img",{src:"/assets/images/pdf.png",class:"w-full h-full object-cover rounded-lg",loading:"lazy"},null,-1)]),8,Dt))),128))]),t("div",jt,[(l(!0),n(M,null,C(i.highlightedMessages,s=>(l(),n("div",{key:s.id,class:"highlighted_item",innerHTML:c(s.message)},null,8,At))),128))])])}}},Lt=z(Bt,[["__scopeId","data-v-8c88e79c"]]),zt={class:"message_wrapper h-100"},Ht={class:"message_item_content"},It={key:0,class:"message_item_avatar shrink-0"},Ft=["src"],Vt=["innerHTML"],Pt={key:1,class:"message_item_avatar shrink-0"},Rt=["src"],Et={class:"message_date"},Ot={key:0,class:"reply-form mt-2 mx-3 mb-3"},Wt=["placeholder","disabled"],Ut={__name:"SupportTicketMessages",props:{messages:Array,supportTicket:Object},emits:["messageSubmitted"],setup(i,{emit:d}){const x=tt(),f=H(),c=I(),e=v(null),a=i,g=d,o=v(""),u=v(!1),p=v(!1);N(()=>a.supportTicket,()=>{var h;p.value=!!((h=a.supportTicket)!=null&&h.user_chat)},{deep:!0}),N(()=>a.messages,()=>{B(m)},{deep:!0}),F(()=>{B(m)});const s=()=>{var h;o.value&&(u.value=!0,axios.post("/support-ticket-message",{message:o.value,ticket_number:(h=a.supportTicket)==null?void 0:h.ticket_no},{headers:{Authorization:c.token}}).then(()=>{o.value="",g("messageSubmitted",!0),u.value=!1}).catch(b=>{u.value=!1,x.error(b.response.data.message,{position:f.langDirection==="rtl"?"bottom-right":"bottom-left"})}))},m=()=>{e.value&&(e.value.scrollTop=e.value.scrollHeight)};function D(h){var b=/(https?:\/\/[^\s]+)/g,w=h.replace(b,function(T){return'<a href="'+T+'" target="_blank">'+T+"</a>"});return w}return(h,b)=>{var w,T,j,A;return l(),n("div",zt,[t("div",{class:$(["messages",((w=a.supportTicket)==null?void 0:w.status)=="pending"||((T=a.supportTicket)==null?void 0:T.status)=="confirm"?"runningConversation":""]),ref_key:"messagesBox",ref:e},[(l(!0),n(M,null,C(i.messages,_=>(l(),n("div",{key:_.id,class:$(["message_item",k(c).user.id==_.sender_id?"sender":"receiver"])},[t("div",Ht,[k(c).user.id!=_.sender_id?(l(),n("div",It,[t("img",{src:_.profile_photo,alt:"avatar",loading:"lazy"},null,8,Ft)])):S("",!0),t("div",{class:"message_item_text",innerHTML:D(_.message)},null,8,Vt),k(c).user.id==_.sender_id?(l(),n("div",Pt,[t("img",{src:_.profile_photo,alt:"avatar",loading:"lazy"},null,8,Rt)])):S("",!0)]),t("div",Et,r(_.created_at),1)],2))),128))],2),((j=a.supportTicket)==null?void 0:j.status)=="pending"||((A=a.supportTicket)==null?void 0:A.status)=="confirm"?(l(),n("div",Ot,[t("form",{onSubmit:J(s,["prevent"])},[q(t("input",{type:"text",placeholder:h.$root.$t("Write a message")+"...",class:$(["w-full p-3 outline-none focus:ring-1 focus:ring-primary",k(f).langDirection=="rtl"?"pl-12":"pr-12"]),required:"","onUpdate:modelValue":b[0]||(b[0]=_=>o.value=_),disabled:!p.value||u.value},null,10,Wt),[[G,o.value]]),p.value?(l(),n("button",{key:0,class:$(["send-btn bg-primary btn",k(f).langDirection=="rtl"?"left-[6px]":"right-[6px]"]),type:"submit"},[u.value?(l(),L(U,{key:1,color:"text-white"})):(l(),L(k(et),{key:0,class:"w-5 h-5 -rotate-45"}))],2)):S("",!0)],32)])):S("",!0)])}}},Zt=z(Ut,[["__scopeId","data-v-00b528a0"]]),qt={class:"h-full flex flex-col"},Gt={class:"bg-white px-3 text-slate-600 flex items-center gap-1 pt-2"},Jt={class:"leading-normal"},Kt={class:"px-2 pt-2 md:px-4 md:pt-4 lg:px-6 lg:pt-6 md:pr-8 lg:pr-16 h-full"},Xt={class:"p-3 md:p-4 xl:p-6 bg-white rounded-xl md:rounded-2xl grid grid-cols-1 lg:grid-cols-2 gap-3 md:gap-4 h-full"},Qt={class:""},le={__name:"SupportTicketDetails",setup(i){const d=I(),x=V(),f=P(),c=H(),e=v({}),a=v([]),g=v([]);let o=null;const u=async()=>{if(o&&(o(),o=null),!!c.pusher_app_key)try{o=await Z({key:c.pusher_app_key,cluster:c.pusher_app_cluster},"support-ticket-message-channel","support-ticket-message-event",s=>{s.ticket_number==x.params.ticketNumber&&p()})}catch(s){console.error("Failed to subscribe to support ticket updates",s)}};F(()=>{p(),u()}),N(()=>({key:c.pusher_app_key,cluster:c.pusher_app_cluster}),()=>{u()});const p=()=>{axios.get("support-ticket/show",{params:{ticket_number:x.params.ticketNumber},headers:{Authorization:d.token}}).then(s=>{e.value=s.data.data.support_ticket,g.value=s.data.data.highlighted_messages,a.value=s.data.data.support_ticket.messages}).catch(s=>{s.response.status===401&&(d.token=null,d.user=null,d.addresses=[],d.favoriteProducts=0,f.push("/"))})};return K(()=>{o&&(o(),o=null)}),(s,m)=>{const D=X("router-link");return l(),n("div",qt,[t("div",Gt,[y(k(st),{class:"w-5 h-5 md:w-6 md:h-6"}),y(D,{to:"/support-tickets",class:"leading-normal hover:text-primary"},{default:Q(()=>[Y(r(s.$t("Support Ticket")),1)]),_:1}),t("span",Jt,"/ "+r(s.$t("Support Ticket Details")),1)]),y(R,{title:s.$t("Support Ticket Details")},null,8,["title"]),t("div",Kt,[t("div",Xt,[y(Lt,{supportTicket:e.value,highlightedMessages:g.value},null,8,["supportTicket","highlightedMessages"]),t("div",Qt,[y(Zt,{messages:a.value,supportTicket:e.value,onMessageSubmitted:m[0]||(m[0]=h=>p())},null,8,["messages","supportTicket"])])])])])}}};export{le as default};
